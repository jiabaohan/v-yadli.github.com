    <html>
    <head>
        <link rel="Stylesheet" type="text/css" href="style.css" />
        <title>Use Volatile as memory barrier</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    </head>
    <body>
        <div class="content">
        
<h1 id="toc_1">Use Volatile as memory barrier</h1>

<p>
 啊～今天又学到了一个小姿势～
</p>

<pre>
Compiler Reordering

Compiler rearrangement is dealt with in this particular case by our use of volatile.
The C++ standard defines that reads of volatile variables cannot be cached nor
delayed at writing. It also defines that volatile reads or writes cannot be moved
past each other.

To quote hax_:


"'volatile' variable access is also code rearrangement barrier: no lines can be
moved up or down through it (you can treat every access to volatile variable as
horizontal barrier in code editor)".

Normally this wouldn't be enough for multi-threading programming since the compiler
can reorder non-volatile read/write relative to volatile read/write. But for this
circular queue it's all read/write of volatile. Either the indexes themselves are
read or written or the array is accessed with a volatile. Thus, this type of queue
is safe from compiler reordering that could break First.

</pre>

        </div>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'yataoblog'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
         })();
     </script>
     <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
     <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </body>
</html>


